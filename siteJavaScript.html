<!DOCTYPE html>
<html>
<head>
  
  <title>Air Quality Map</title>

  <!-- add leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
  integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
  crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
  integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
  crossorigin=""></script>

  <!-- add a slider -->
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script>
    $( function() {
      $( "#slider-range" ).slider({
        range: true,
        min: (new Date("2022-01-01")).getTime(),
        max: (new Date("2022-12-31")).getTime(),
        values: [ (new Date("2022-01-01")).getTime(), (new Date("2022-02-01")).getTime() ],
        slide: function( event, ui ) {
          var date1 = new Date(ui.values[0]);
          var date2 = new Date(ui.values[1]);
          maFonction(date1.getTime(), date2.getTime());
          $( "#date1-label" ).html( String(date1.getTime()) + "/" + String(date1.getMonth() + 1) + "/" + String(date1.getFullYear()) );
          $( "#date2-label" ).html( String(date2.getTime()) + "/" + String(date2.getMonth() + 1) + "/" + String(date2.getFullYear()) );
        }
      });
    } );
  </script>


  <style>
    #map {
      height: 100%;
      width: 100%;
    }
    #slider-range {
      position: absolute;
      width: 90%;
      top: 10px;
      left: 5%;
      right: 5%;
      z-index: 2;
    }
    #slider-range .slider-label-left {
      position: absolute;
      top: 20px;
      left: 5%;
      z-index: 2;
    }
    #slider-range .slider-label-right {
      position: absolute;
      top: 40px;
      left: 5%;
      z-index: 2;
    }
  </style>

  <style>
    html, body {
      padding: 0;
      margin: 0;
      width: 100%;
      height: 100%;
    }
  </style>
  
</head>
<body>

  <div id="slider-range">
    <div class="slider-label-left">Date 1: <span id="date1-label"></span></div>
    <div class="slider-label-right">Date 2: <span id="date2-label"></span></div>
  </div>


  <div id="slider-range"></div>

  <div id="map" style="position:relative;height:100vh;z-index:0"> </div>

  <script>
    var data = [
      {timestamp: 1648771209, sensorID: "A", pm25: 10, pm10: 20, latitude: 53.3498, longitude: -6.2603},
      {timestamp: 1648771221, sensorID: "B", pm25: 15, pm10: 25, latitude: 53.3489, longitude: -6.2468},
      {timestamp: 1648771251, sensorID: "C", pm25: 15, pm10: 25, latitude: 53.3479, longitude: -6.2468},
      // Add more data here
    ];

    var map = L.map('map').setView([53.3501, -6.26], 12);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);


    function maFonction(date1, date2) {
      zones = [];
      map.eachLayer(function (layer) {
        if (layer instanceof L.Circle) {
          map.removeLayer(layer);
        }
      });

      for (var i = 0; i < data.length; i++) {
        if ( data[i].timestamp*1000 > date1 && data[i].timestamp*1000 < date2 ) {
          var color = "";
          if (data[i].pm25 < 12) {
            color = "#00FF00";
          } else if (data[i].pm25 >= 12 && data[i].pm25 < 35.5) {
            color = "#FFFF00";
          } else if (data[i].pm25 >= 35.5 && data[i].pm25 < 55.5) {
            color = "#FFA500";
          } else if (data[i].pm25 >= 55.5 && data[i].pm25 < 150.5) {
            color = "#FF0000";
          } else {
            color = "#8B008B";
          }

          var zone = L.circle([data[i].latitude, data[i].longitude], {
            color: color,
            fillColor: color,
            fillOpacity: 0.2,
            radius: 300
          }).addTo(map);

          zone.bindPopup("Sensor ID: " + data[i].sensorID + "<br>PM2.5: " + data[i].pm25 + "<br>PM10: " + data[i].pm10);
          zones.push(zone);
        }
      }
    }

  </script>
</body>
</html>
